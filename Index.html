<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Database with Login</title>
  <style>
    body { font-family: sans-serif; padding: 20px; direction: rtl; }
    .form-group { margin: 10px 0; }
    input, select { padding: 5px; margin: 5px; width: 200px; }
    img { max-height: 80px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .voucher { display: none; }
    .printable { font-family: 'Noto Nastaliq Urdu', serif; font-size: 18px; padding: 20px; }
    .hidden { display: none; }
    #loginBox { max-width: 300px; margin: auto; text-align: center; padding-top: 100px; }
  </style>
</head>
<body>

<div id="loginBox">
  <h2>ğŸ” Admin Login</h2>
  <input type="text" id="username" placeholder="Username"><br>
  <input type="password" id="password" placeholder="Password"><br><br>
  <button onclick="login()">Login</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="adminPanel" class="hidden">
  <h2>ğŸ“š School Student Database - Admin Panel</h2>

  <div class="form-group">
    <input type="text" id="name" placeholder="Student Name">
    <input type="text" id="fatherName" placeholder="Father Name">
    <input type="text" id="className" placeholder="Class">
    <input type="text" id="studentId" placeholder="Student ID">
    <input type="number" id="fee" placeholder="Total Fee">
    <input type="number" id="paid" placeholder="Paid Fee">
    <input type="file" id="photo" accept="image/*">
    <button onclick="addStudent()">Add Student</button>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="search-box">
    ğŸ” Search:
    <input type="text" id="searchInput" placeholder="Search by Name or ID" onkeyup="searchStudent()">
  </div>

  <table id="studentTable">
    <thead>
      <tr>
        <th>Photo</th>
        <th>Name</th>
        <th>Father Name</th>
        <th>Class</th>
        <th>ID</th>
        <th>Total Fee</th>
        <th>Paid</th>
        <th>Balance</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div id="voucher" class="voucher printable"></div>

<script>
  // === LOGIN SYSTEM ===
  const ADMIN_USER = 'admin';
  const ADMIN_PASS = '1234';

  function login() {
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;

    if (user === ADMIN_USER && pass === ADMIN_PASS) {
      document.getElementById('loginBox').classList.add('hidden');
      document.getElementById('adminPanel').classList.remove('hidden');
      loadStudents();
    } else {
      document.getElementById('loginError').innerText = "Invalid credentials!";
    }
  }

  function logout() {
    location.reload();
  }

  // === STUDENT SYSTEM ===
  let students = [];

  function saveToStorage() {
    localStorage.setItem("students", JSON.stringify(students));
  }

  function loadStudents() {
    const saved = localStorage.getItem("students");
    if (saved) {
      students = JSON.parse(saved);
      renderTable();
    }
  }

  function addStudent() {
    const name = document.getElementById("name").value.trim();
    const fatherName = document.getElementById("fatherName").value.trim();
    const className = document.getElementById("className").value.trim();
    const studentId = document.getElementById("studentId").value.trim();
    const fee = parseFloat(document.getElementById("fee").value.trim());
    const paid = parseFloat(document.getElementById("paid").value.trim());
    const balance = fee - paid;
    const photoInput = document.getElementById("photo");

    if (!name || !studentId) {
      alert("Name and ID are required.");
      return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
      const photo = e.target.result;
      students.push({ name, fatherName, className, studentId, fee, paid, balance, photo });
      saveToStorage();
      renderTable();
      clearForm();
    };
    if (photoInput.files[0]) {
      reader.readAsDataURL(photoInput.files[0]);
    } else {
      students.push({ name, fatherName, className, studentId, fee, paid, balance, photo: "" });
      saveToStorage();
      renderTable();
      clearForm();
    }
  }

  function renderTable() {
    const tbody = document.querySelector("#studentTable tbody");
    tbody.innerHTML = "";
    students.forEach((s, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${s.photo ? `<img src="${s.photo}">` : ""}</td>
        <td>${s.name}</td>
        <td>${s.fatherName}</td>
        <td>${s.className}</td>
        <td>${s.studentId}</td>
        <td>${s.fee}</td>
        <td>${s.paid}</td>
        <td>${s.fee - s.paid}</td>
        <td>
          <button onclick="editStudent(${i})">âœï¸</button>
          <button onclick="deleteStudent(${i})">ğŸ—‘ï¸</button>
          <button onclick="printVoucher(${i})">ğŸ§¾</button>
        </td>
      `;
      tbody.appendChild(row);
    });
  }

  function clearForm() {
    document.getElementById("name").value = "";
    document.getElementById("fatherName").value = "";
    document.getElementById("className").value = "";
    document.getElementById("studentId").value = "";
    document.getElementById("fee").value = "";
    document.getElementById("paid").value = "";
    document.getElementById("photo").value = "";
  }

  function deleteStudent(index) {
    if (confirm("Are you sure?")) {
      students.splice(index, 1);
      saveToStorage();
      renderTable();
    }
  }

  function editStudent(index) {
    const s = students[index];
    document.getElementById("name").value = s.name;
    document.getElementById("fatherName").value = s.fatherName;
    document.getElementById("className").value = s.className;
    document.getElementById("studentId").value = s.studentId;
    document.getElementById("fee").value = s.fee;
    document.getElementById("paid").value = s.paid;
    deleteStudent(index);
  }

  function searchStudent() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const rows = document.querySelectorAll("#studentTable tbody tr");
    rows.forEach(row => {
      const name = row.children[1].textContent.toLowerCase();
      const id = row.children[4].textContent.toLowerCase();
      if (name.includes(query) || id.includes(query)) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }

  function printVoucher(index) {
    const s = students[index];
    const voucher = document.getElementById("voucher");
    voucher.innerHTML = `
      <h3>ğŸ“„ ÙÛŒØ³ Ø±Ø³ÛŒØ¯</h3>
      <p><strong>Ù†Ø§Ù…:</strong> ${s.name}</p>
      <p><strong>ÙˆÙ„Ø¯:</strong> ${s.fatherName}</p>
      <p><strong>Ú©Ù„Ø§Ø³:</strong> ${s.className}</p>
      <p><strong>Ø´Ù†Ø§Ø®ØªÛŒ ID:</strong> ${s.studentId}</p>
      <p><strong>Ú©Ù„ ÙÛŒØ³:</strong> ${s.fee} Ø±ÙˆÙ¾Û’</p>
      <p><strong>Ø§Ø¯Ø§ Ø´Ø¯Û:</strong> ${s.paid} Ø±ÙˆÙ¾Û’</p>
      <p><strong>Ø¨Ù‚Ø§ÛŒØ§:</strong> ${s.fee - s.paid} Ø±ÙˆÙ¾Û’</p>
      <br><br>
      <p>Ø¯Ø³ØªØ®Ø·: _______________________</p>
    `;
    voucher.style.display = "block";
    window.print();
    voucher.style.display = "none";
  }
</script>

</body>
</html>
